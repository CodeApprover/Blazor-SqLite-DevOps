---
name: "Set Deployment Success"

on:
  repository_dispatch:
    types: trigger-deployment-success

env:
  SHA: ${{ github.event.client_payload.sha }}
  SHA_BRANCH: ${{ github.event.client_payload.sha_branch }}
  CSPROJ: ${{ github.event.client_payload.csproj }}

jobs:
  publish-deployment-success:

    name: Publish Deployment Success
    runs-on: ubuntu-latest
    timeout-minutes: 15
    #if: (github.actor != ${{ github.repository_owner }}) # prevent workflow
    steps:

    - name: Checkout SHA Repository
      id: checkout
      uses: actions/checkout@v3.5.3
      with:
        ref: ${{ env.SHA }}
        fetch-depth: 0

    - name: Update Deployment Status - Success
      run: |
        curl -X POST \
          -H "Authorization: Bearer $GITHUB_TOKEN" \
          -H "Accept: application/vnd.github.v3+json" \
          "https://api.github.com/repos/${{ github.repository }}/deployments/${{ github.event.deployment.id }}/statuses" \
          -d '{
            "state": "success",
            "description": "Deployment was successful",
            "environment": "${{ env.ENVIRONMENT }}",
            "auto_inactive": true
          }'
      env:
        GITHUB_TOKEN: ${{ secrets.AUTH }}
