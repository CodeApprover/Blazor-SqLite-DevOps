---
name: "Development Success"

#  Confirms the success of the development workflow by publishing a success status for the related commit.

on:
  repository_dispatch:
    types: trigger-development-success

env:
  SHA: ${{ github.event.client_payload.sha }}
  SHA_BRANCH: ${{ github.event.client_payload.sha_branch }}
  CSPROJ: ${{ github.event.client_payload.csproj }}

jobs:
  succeed:
    name: Publisah Development Success Status
    runs-on: ubuntu-latest
    timeout-minutes: 15
    #if: (github.actor != ${{ github.repository_owner }}) # prevents workflow

    steps:

    - name: Publish Development Success Status
      run: |
        # Make a curl request to update the commit status
        CMD="curl -X POST -H \"Authorization: token ${{ secrets.AUTH }}\ "
        CMD+="-H \"Accept: application/vnd.github.v3+json\" "
        CMD+="https://api.github.com/repos/${{ github.repository }}/statuses/${{ env.SHA }} "
        CMD+="-d '{"state": "success","description": "All development workflows succeeded.","context": "status/${{ github.workflow }}"
        }' 
        echo "$CMD"
        eval $(CMD) || exit 9
