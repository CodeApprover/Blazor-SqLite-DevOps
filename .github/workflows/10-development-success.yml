---
name: "Deployment Success"

on:
  repository_dispatch:
    types: trigger-deployment-success

env:
  SHA: ${{ github.event.client_payload.sha }}
  SHA_BRANCH: ${{ github.event.client_payload.sha_branch }}
  CSPROJ: ${{ github.event.client_payload.csproj }}

jobs:
  publish-deployment-success:

    name: Publish Deployment Success
    runs-on: ubuntu-latest
    timeout-minutes: 15
    #if: (github.actor != ${{ github.repository_owner }}) # prevent workflow
    steps:

    - name: Checkout SHA Repository
      uses: actions/checkout@v3.5.3
      with:
        ref: ${{ env.SHA }}
        fetch-depth: 0

    - name: Set Environment
      run: |
        envirn="${{ env.SHA_BRANCH/#code-}}"
        echo "ENVIRONMENT=$envirn" >> $GITHUB_ENV

    - name: Publish Environment Deployment Approval
      uses: activescott/automate-environment-deployment-approval@v1.0.1
      with:
        github_token: ${{ secrets.AUTH }}
        environment_allow_list: ${{ env.ENVIRONMENT }}
        actor_allow_list: |
          dependabot[bot]
          ${{ github.repository_owner }}
